.form
  %span content id:
  = @content.id
  .url
    %span url:
    %span
      = @uri.scheme
      %span> ://
      %a.host(href='javascript:void(0)')= @uri.host
      %span> :
      %a.port(href='javascript:void(0)')= @uri.port
      - @uri.path.scan(/(?<=\/)[^\/]*/).each do |s|
        %span> /
        - if s.present?
          %a.btn.path-btn(href='javascript:void(0)')= s
      - if @uri.query
        %span> ?
        = @uri.query
      - if @uri.fragment
        %span> #
        = @uri.fragment
    %span
      %a{href: @content.url, target: 'blank'} GO
  = form_for @host_rule, :url => rules_path, :method => :post do |host_rule_form|
    = hidden_field_tag :content_id, @content.id
    .host-port
      %span host:
      = host_rule_form.text_field :host, :class => 'host'
      %span port:
      = host_rule_form.number_field :port, :max => 65535, :min => 1, :class => 'port'
      = host_rule_form.check_box :include_sub
      = host_rule_form.label :include_sub
      = host_rule_form.check_box :excluded
      = host_rule_form.label :excluded
      %span @id:
      = host_rule_form.text_field :id, :size => 3, :readonly => true
      %a.btn.remove-btn.remove-host-ref-id(href='javascript:void(0)') x
    .path
      = fields_for @path_rule do |path_rule_form|
        .url-path
          %span path:
          - @uri.path.scan(/(?<=\/)[^\/]*/).each do |s|
            %span /
            - if s.present?
              = path_rule_form.text_field :path_pattern_items, :name => 'path_rule[path_pattern_items][]', :value => s, :readonly => true, :size => 20, :class => 'path-pattern-item'
              %a.btn.path-all-btn(href='javascript:void(0)') 全部
            - else
              = path_rule_form.text_field :path_pattern_items, :name => 'path_rule[path_pattern_items][]', :value => '', :class => 'hidden'
          %span (regex)
          = path_rule_form.check_box :excluded
          = path_rule_form.label :excluded
        .title-css-path
          %span title css path:
          = path_rule_form.text_field :title_css_path, :size => 100
          %a.btn.html-head-title-btn(href='javascript:void(0)') head title
        .content-css-paths
          %span content css paths:
          .content-css-paths-data
            - path_rule_form.object.content_css_paths_data.each do |path|
              %ul
                %li
                  %span x
                  = path
    - if @existed_host_rules.present?
      .existed-host-rule
        已有的规则:
        %table
          %tr
            %th id
            %th host
            %th port
            %th include sub
            %th excluded
          - @existed_host_rules.each do |r|
            %tr
              %td
                %a(href='javascript:void(0)')= r.id
              %td= r.host
              %td= r.port || '-'
              %td= r.include_sub
              %td= r.excluded
    = host_rule_form.submit

%div
  %table.css-path-setting
    %tbody
      %tr
        %td(style='vertical-align:top;')
          %div(style='width:800px;')
            %iframe#source_iframe(style='width:100%;height:100% !important' src="/contents/#{@content.id}/source")
        %td(style='vertical-align:top;')
          %div.input-path-preview(style='width:300px;')
            - cache = Nokogiri.parse(@content.cache)
            - cache.css('script, head link').remove
            = cache.to_s.html_safe
        %td(valign="top" )
          %div(style='width:300px;')
            .css-path-setting
              %span
                %input.css-path-input(type='text')
                %a.btn.set-title-css-path-btn(href='javascript:void(0)') 标题
                %a.btn.set-content-css-path-btn(href='javascript:void(0)') 正文
            .dom-tree
              #jstree_div

.hidden
  - source = Nokogiri.parse @content.source
  - source.css('script, style, head link').remove
  = hidden_field_tag :source, source.to_s




